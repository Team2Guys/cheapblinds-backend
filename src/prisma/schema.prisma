generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =================== Enums ===================
enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

// =================== Admin ===================
model Admin {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @db.VarChar(100)
  email       String   @unique @db.VarChar(255)
  password    String   @db.VarChar(255)
  role        Role     @default(ADMIN)
  permissions String[] @default([])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([email])
}

// =================== User ===================
model User {
  id                     String   @id @default(uuid()) @db.Uuid
  firstName              String   @db.VarChar(100)
  lastName               String   @db.VarChar(100)
  email                  String   @unique @db.VarChar(255)
  password               String   @db.VarChar(255)
  isEmailVerified        Boolean  @default(false)
  isNewsletterSubscribed Boolean  @default(false)
  role                   Role     @default(USER)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  @@index([email])
}

// =================== Category ===================
model Category {
  id               String        @id @default(uuid()) @db.Uuid
  name             String        @unique @db.VarChar(100)
  description      String?       @db.Text()
  shortDescription String?       @db.VarChar(255)
  customUrl        String?       @unique @db.VarChar(255)
  metaTitle        String?       @db.VarChar(70)
  metaDescription  String?       @db.VarChar(160)
  canonicalTag     String?       @db.VarChar(255)
  breadCrumb       String?       @db.VarChar(255)
  thumbnailUrl     String?       @db.VarChar(512)
  lastEditedBy     String?       @db.VarChar(255)
  seoSchema        String?       @db.Text()
  status           ContentStatus @default(PUBLISHED)
  products         Product[]     @relation("CategoryProducts")
  subcategories    Subcategory[] @relation("CategorySubcategories")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@index([name])
  @@index([customUrl])
}

// =================== Subcategory ===================
model Subcategory {
  id               String        @id @default(uuid()) @db.Uuid
  name             String        @db.VarChar(100)
  description      String?       @db.Text()
  shortDescription String?       @db.VarChar(255)
  customUrl        String?       @unique @db.VarChar(255)
  metaTitle        String?       @db.VarChar(70)
  metaDescription  String?       @db.VarChar(160)
  canonicalTag     String?       @db.VarChar(255)
  breadCrumb       String?       @db.VarChar(255)
  thumbnailUrl     String?       @db.VarChar(512)
  lastEditedBy     String?       @db.VarChar(255)
  seoSchema        String?       @db.Text()
  categoryId       String        @db.Uuid
  category         Category      @relation(fields: [categoryId], references: [id], name: "CategorySubcategories", onDelete: Cascade)
  products         Product[]     @relation("SubcategoryProducts")
  status           ContentStatus @default(PUBLISHED)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@index([categoryId])
  @@index([customUrl])
}

// =================== Product ===================
model Product {
  id               String         @id @default(uuid()) @db.Uuid
  name             String?        @db.VarChar(100)
  description      String?        @db.Text()
  shortDescription String?        @db.VarChar(255)
  customUrl        String?        @unique @db.VarChar(255)
  metaTitle        String?        @db.VarChar(70)
  metaDescription  String?        @db.VarChar(160)
  canonicalTag     String?        @db.VarChar(255)
  breadCrumb       String?        @db.VarChar(255)
  thumbnailUrl     String?        @db.VarChar(512)
  productImages    String[]       @default([])
  lastEditedBy     String?        @db.VarChar(255)
  seoSchema        String?        @db.Text()
  price            Float          @default(0)
  discountPrice    Int?           @default(0)
  stock            Int            @default(0)
  additionalInfo   Json[]         @default([]) @db.JsonB()
  measuringGuide   Json[]         @default([]) @db.JsonB()
  categoryId       String         @db.Uuid
  subcategoryId    String         @db.Uuid
  category         Category       @relation(fields: [categoryId], references: [id], name: "CategoryProducts", onDelete: Cascade)
  subcategory      Subcategory    @relation(fields: [subcategoryId], references: [id], name: "SubcategoryProducts", onDelete: Cascade)
  status           ContentStatus? @default(PUBLISHED)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@index([name])
  @@index([categoryId])
  @@index([subcategoryId])
  @@index([price])
  @@index([customUrl])
}
