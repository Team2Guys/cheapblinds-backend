generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum AdminRole {
  ADMIN
  SUPER_ADMIN
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum OrderStatus {
  PENDING
  PAID
  CANCELED
  FAILED
  SHIPPED
  COMPLETED
}

enum PaymentStatus {
  FREE
  PENDING
  PAID
  CANCELED
  FAILED
}

enum InquiryType {
  EMAIL
  PHONE
  WHATSAPP
  OTHER
}

enum InquiryStatus {
  NEW
  READ
  RESOLVED
}

enum Permissions {
  ADD_PRODUCTS
  EDIT_PRODUCTS
  DELETE_PRODUCTS
  ADD_CATEGORY
  DELETE_CATEGORY
  EDIT_CATEGORY
  CHECK_PROFIT
  CHECK_REVENUE
  CHECK_VISITORS
  VIEW_USERS
  VIEW_SALES
  VIEW_ADMINS
  VIEW_TOTAL_PRODUCTS
  VIEW_TOTAL_CATEGORIES
}

enum AddressType {
  HOME
  OFFICE
  OTHER
}

model Admin {
  id           String        @id @default(uuid()) @db.Uuid
  name         String
  email        String        @unique
  password     String
  role         AdminRole     @default(ADMIN)
  permissions  Permissions[] @default([])
  lastEditedBy String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model User {
  id                       String   @id @default(uuid()) @db.Uuid
  defaultShippingAddressId String?  @unique @db.Uuid
  defaultBillingAddressId  String?  @unique @db.Uuid
  firstName                String
  lastName                 String
  email                    String   @unique
  password                 String
  isEmailVerified          Boolean  @default(false)
  isMember                 Boolean  @default(false)
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  addresses              Address[] @relation(name: "UserAddresses")
  orders                 Order[]   @relation(name: "UserOrders")
  defaultShippingAddress Address?  @relation(name: "DefaultShipping", fields: [defaultShippingAddressId], references: [id])
  defaultBillingAddress  Address?  @relation(name: "DefaultBilling", fields: [defaultBillingAddressId], references: [id])
}

model Address {
  id          String      @id @default(uuid()) @db.Uuid
  userId      String      @db.Uuid
  firstName   String
  lastName    String
  email       String
  phone       String
  address     String
  city        String
  state       String
  country     String
  addressType AddressType @default(HOME)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  user               User  @relation(name: "UserAddresses", fields: [userId], references: [id], onDelete: Cascade)
  defaultShippingFor User? @relation(name: "DefaultShipping")
  defaultBillingFor  User? @relation(name: "DefaultBilling")
}

model NewsletterSubscriber {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id               String        @id @default(uuid()) @db.Uuid
  name             String        @unique
  slug             String        @unique
  shortDescription String?
  description      String?       @db.Text()
  metaTitle        String?
  metaDescription  String?
  canonicalUrl     String?
  breadcrumb       String?
  posterImageUrl   String?
  seoSchema        String?       @db.Text()
  status           ContentStatus @default(PUBLISHED)
  lastEditedBy     String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  products      Product[]     @relation(name: "CategoryProducts")
  subcategories Subcategory[] @relation(name: "CategorySubcategories")
}

model Subcategory {
  id               String        @id @default(uuid()) @db.Uuid
  categoryId       String        @db.Uuid
  name             String
  slug             String
  shortDescription String?
  description      String?       @db.Text()
  metaTitle        String?
  metaDescription  String?
  canonicalUrl     String?
  breadcrumb       String?
  posterImageUrl   String?
  seoSchema        String?       @db.Text()
  status           ContentStatus @default(PUBLISHED)
  lastEditedBy     String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  category Category  @relation(name: "CategorySubcategories", fields: [categoryId], references: [id], onDelete: Cascade)
  products Product[] @relation(name: "SubcategoryProducts")

  @@unique([categoryId, slug])
}

model Product {
  id               String        @id @default(uuid()) @db.Uuid
  categoryId       String        @db.Uuid
  subcategoryId    String        @db.Uuid
  fabricId         Int
  blindTypeId      Int
  sku              String        @unique
  name             String
  slug             String
  shortDescription String?
  description      String?       @db.Text()
  metaTitle        String?       @db.Text()
  metaDescription  String?       @db.Text()
  canonicalUrl     String?
  breadcrumb       String?
  posterImageUrl   String?
  productUrl       String?
  productImages    String[]      @default([])
  price            Decimal       @default(0)
  discountPrice    Decimal?
  motorPrice       Decimal?
  minDrop          Int           @default(0)
  maxDrop          Int           @default(1)
  minWidth         Int           @default(0)
  maxWidth         Int           @default(1)
  inStock          Boolean       @default(false)
  color            String?
  pattern          String?
  material         String?
  isMotorized      Boolean       @default(false)
  additionalInfo   String?       @db.Text()
  measuringGuide   String?       @db.Text()
  seoSchema        String?       @db.Text()
  status           ContentStatus @default(PUBLISHED)
  lastEditedBy     String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  category    Category    @relation(name: "CategoryProducts", fields: [categoryId], references: [id], onDelete: Cascade)
  subcategory Subcategory @relation(name: "SubcategoryProducts", fields: [subcategoryId], references: [id], onDelete: Cascade)
  orderItems  OrderItem[] @relation(name: "ProductOrderItems")

  @@unique([subcategoryId, slug])
}

model Order {
  id            String        @id @default(uuid()) @db.Uuid
  userId        String        @db.Uuid
  firstName     String
  lastName      String
  email         String
  phone         String
  address       String        @db.Text()
  city          String
  state         String
  country       String
  totalAmount   Decimal       @default(0)
  shippingCost  Decimal       @default(0)
  notes         String?       @db.Text()
  paymentStatus PaymentStatus @default(PENDING)
  orderStatus   OrderStatus   @default(PENDING)
  lastEditedBy  String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  user       User        @relation(name: "UserOrders", fields: [userId], references: [id], onDelete: Restrict)
  orderItems OrderItem[] @relation(name: "OrderItems")
}

model OrderItem {
  id             String           @id @default(uuid())
  orderId        String           @db.Uuid
  productId      String?          @db.Uuid
  fabricId       Int
  blindTypeId    Int
  sku            String           @unique
  name           String
  posterImageUrl String?
  productUrl     String?
  price          Decimal          @default(0)
  finalPrice     Decimal          @default(0)
  motorPrice     Decimal?
  drop           Int              @default(0)
  width          Int              @default(1)
  isMotorized    Boolean          @default(false)
  recessType     String?
  options        OrderItemOptions @relation(name: "OrderItemOptions", fields: [orderItemOptionsId], references: [id])

  order              Order    @relation(name: "OrderItems", fields: [orderId], references: [id], onDelete: Cascade)
  product            Product? @relation(name: "ProductOrderItems", fields: [productId], references: [id], onDelete: SetNull)
  orderItemOptionsId String
}

model OrderItemOptions {
  id            String  @id @default(uuid())
  headrailType  String?
  stackingStyle String?
  lining        String?
  chainControl  String?
  chainSide     String?

  orderItems OrderItem[] @relation(name: "OrderItemOptions")
}

model Inquiry {
  id            String        @id @default(uuid()) @db.Uuid
  name          String
  email         String
  phone         String
  message       String?       @db.Text()
  inquiryType   InquiryType   @default(OTHER)
  inquiryStatus InquiryStatus @default(NEW)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}
